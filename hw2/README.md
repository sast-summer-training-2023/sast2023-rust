# 暑培4.0 Rust 课程作业

> Author：Yoimiya

> 本作业框架引用自[曙光磁铁/retris - 码云 - 开源中国 (gitee.com)](https://gitee.com/dawn_magnet/retris)的项目，遵守 GNU GENERAL PUBLIC LICENSE协议，特此鸣谢！

## 作业介绍

本次作业仍然采用代码填空的方式进行，同学们需要阅读给定框架的代码，并且自行在标注了TODO的部分进行简单补充，从而完成一个完整可编译的程序。



## 程序功能介绍

这个程序是一个用Rust实现俄罗斯方块的简易框架，当你进入到项目根目录之后，可以使用如下指令运行：

```shell
$ cargo run --bin std
```

得到的界面如下：

![img](https://s3.ax1x.com/2021/01/20/sRuGjA.gif)



> 相关按键功能如上图，其中↑代表变形，其他按键都是指明了功能。~~俄罗斯方块的玩法应该不用我说了吧~~



## 运行框架

使用如下指令即可运行我们的框架：

```shell
$ cargo run --bin hw2
```

但你会发现会报很多错误，所以你需要去改正这些错误，使得通过编译的同时能够正常运行游戏。



需要改动的地方均用TODO标出来了，你可以使用搜索功能查询所有TODO的位置，方便快速定位。



## 框架说明

* std.rs：标程，可以运行得到标准程序进行参考
* frame.rs：负责绘制游戏UI外围的框架线条，游戏过程中保持不变
* interface.rs：负责负责根据给定状态来绘制游戏内部的文字界面，会随着游戏进行实时更新
* tetris.rs：单个方块的状态信息，包括TSZJLIO型方块共七种。
* game.rs：游戏状态演化控制，可以实现方块的移动与变形，并且存储当前所有方块的状态，包括位置和方向等
* main.rs：主逻辑，负责接受外部输入并且呈现图形化输出



## 补充知识

框架中用到了一些课程上没有提到的知识，故在此说明：

* lazy_static：用于初始化定义全局变量并为其赋初值。Rust中不支持直接在全局变量绑定初值，需要通过lazy_static来规定其初始化的值。

* Mutex：互斥锁，当作用于一个变量x时，相当于给变量x上了一把锁。如果想访问变量，首先要通过`lock`操作来解锁。当变量访问完毕，需要调用`drop(x)`来指明释放锁。一个锁只能由一个人持有，如果有多个人同时在要求解锁，那么只能等待某一个人释放锁之后，把锁交给其他人中的某一个，剩下的人继续等。

  > 锁的存在主要是为了解决线程冲突问题，但这个概念有些复杂，不在此阐述。

  人话版：使用了Mutex包装的变量，在访问的时候需要通过调用`lock`来访问内部变量。

* thread::spawn：新建一个线程，并执行内部的函数，概念过于复杂不在此阐述，只要认为内部的函数会被执行就行。

* crossterm：一个外部的包，可以用来接受外部信号，并且以图形化方式输出，相关文档见：[crossterm - Rust (docs.rs)](https://docs.rs/crossterm/latest/crossterm/)



## 尾声

本次作业没有DDL，希望大家能够在完成填空的过程中理解整个项目的运行流程，从而熟悉Rust项目开发的过程。

如果你对填写的内容没有头绪，可以参考`std.rs`，毕竟那个是标程。

祝大家玩的愉快！